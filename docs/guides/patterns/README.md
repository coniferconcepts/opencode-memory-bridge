# Working with Patterns

Guide to understanding and using the pattern library.

## What Are Patterns?

Patterns are battle-tested, reusable code solutions for common problems. They include:
- Complete code implementations
- Best practices built-in
- Dependencies and prerequisites
- Instantiation templates

## Pattern Types

### Architecture Patterns

High-level structural patterns.

**Feature-Based Structure**
```
organize by feature, not by type
src/
├── features/
│   ├── auth/
│   │   ├── components/
│   │   ├── hooks/
│   │   └── api/
│   └── profile/
```

**API Layer Pattern**
- tRPC + Hono setup
- Unified error handling
- Type-safe clients

### Component Patterns

Reusable UI components.

**Data Table**
- Sortable columns
- Filtering
- Pagination
- Row selection

**Form Builder**
- Dynamic forms
- Validation integration
- Error handling
- Submission handling

### Hook Patterns

Custom React hooks.

**useQueryParams**
```typescript
const { filters, setFilters } = useQueryParams()
// Syncs URL state with component state
```

**useLocalStorage**
```typescript
const [value, setValue] = useLocalStorage('key', defaultValue)
// Persisted state across sessions
```

## Using Patterns

### Instantiation

Use the pattern instantiation command:

```bash
@tool-utility instantiate-pattern data-table --target src/components/
```

Or in OpenCode:
```
@tool-utility create a data table component in src/components/
```

### Customization

Patterns are templates - customize after instantiation:

```typescript
// Generated by pattern
export function DataTable({ data, columns }) {
  // ... pattern implementation
}

// Your customization
export function UserTable({ users }) {
  return (
    <DataTable
      data={users}
      columns={[
        { key: 'name', title: 'Name' },
        { key: 'email', title: 'Email' },
      ]}
    />
  )
}
```

## Pattern Structure

Each pattern includes:

```
pattern-name/
├── pattern.yaml          # Pattern definition
├── Component.tsx         # Main component
├── Component.test.tsx    # Tests
├── types.ts              # TypeScript types
└── README.md             # Usage documentation
```

## Available Patterns

### Components

| Pattern | Purpose | Dependencies |
|---------|---------|--------------|
| data-table | Sortable, filterable table | @tanstack/react-table |
| form-builder | Dynamic forms | valibot, tamagui |
| modal-system | Accessible modals | tamagui |
| toast-notifications | User feedback | tamagui |

### Hooks

| Pattern | Purpose |
|---------|---------|
| use-query-params | URL state management |
| use-local-storage | Persistent state |
| use-debounce | Input debouncing |
| use-permissions | Authorization |

### Architecture

| Pattern | Purpose |
|---------|---------|
| feature-based-structure | Project organization |
| api-layer-pattern | tRPC + Hono setup |
| state-management | Legend State patterns |

## Creating Custom Patterns

### 1. Create Pattern Directory

```bash
mkdir -p universal/patterns/custom/my-pattern
```

### 2. Define Pattern

Create `pattern.yaml`:

```yaml
name: My Pattern
version: 1.0.0
description: What this pattern does

files:
  - name: Component.tsx
    template: Component.tsx.template
    required: true
  - name: Component.test.tsx
    template: Component.test.tsx.template
    required: false

dependencies:
  - package-name

prerequisites:
  - tanstack-start stack

instantiation:
  command: "@tool-utility instantiate-pattern my-pattern --target src/"
```

### 3. Create Templates

Templates use placeholders:

```typescript
// Component.tsx.template
export function {{ComponentName}}() {
  return (
    <div>
      {/* Implementation */}
    </div>
  )
}
```

### 4. Test Pattern

```bash
@tool-utility instantiate-pattern my-pattern --target /tmp/test
cd /tmp/test
# Verify it works
```

## Best Practices

### 1. Start with Patterns

Use patterns for common structures instead of building from scratch.

### 2. Customize Don't Rewrite

Start with a pattern, customize for your needs, don't rewrite completely.

### 3. Keep Patterns Updated

As you improve implementations, update the patterns for future use.

### 4. Share Improvements

Contribute pattern improvements back to the base-layer.

## Pattern Evolution

Patterns improve over time based on:

- **Usage data** - Which patterns are used most
- **Success metrics** - Do they reduce bugs?
- **Community feedback** - What works, what doesn't
- **Real-world testing** - Production usage

## Contributing Patterns

See [Contributing Guide](../../development/contributing.md) for how to add patterns to the base-layer.

## Further Reading

- [Architecture Proposal](../../architecture/PROPOSAL.md) - Pattern library vision
- [Pattern Directory](../../../universal/patterns/) - All available patterns
